<script>
    function goDownload() {
        const oid = document.getElementById('orderId').value.trim();
        const msgDiv = document.getElementById('msg');
        if(!oid) return;
        
        const salt = "EIVEN_SECURE_2026_SYSTEM_SALT_X9"; 
        // 强制小写对齐
        const hash = CryptoJS.SHA256(oid + salt).toString(CryptoJS.enc.Hex).toLowerCase().substring(0, 16);
        
        const targetDir = `./releases/${hash}/`;
        const fileName = "EIVEN_V.E.py"; // 你的主程序名

        msgDiv.style.color = "#888";
        msgDiv.innerText = "校验中，请稍后...";

        // 直接尝试访问主文件
        fetch(targetDir + fileName, { method: 'HEAD' })
            .then(res => {
                if(res.ok) {
                    msgDiv.style.color = "#00ff00";
                    msgDiv.innerText = "✅ 验证通过！正在下载主程序...";
                    // 1秒后直接跳转到文件下载，而不是文件夹
                    setTimeout(() => {
                        window.location.href = targetDir + fileName;
                    }, 1000);
                } else {
                    msgDiv.style.color = "#ff4444";
                    msgDiv.innerText = `❌ 未找到您的专属包。\n请检查 ID 是否输入正确。\n(Debug Hash: ${hash})`;
                }
            })
            .catch(err => {
                msgDiv.innerText = "❌ 连接失败，请检查网络或刷新重试。";
            });
    }
</script>
